<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç SMART AI RECON - Professional Bug Bounty Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0b0e;
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a1c22 0%, #0f1117 100%);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2a2e3a;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #00ffaa;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header h1 span {
            font-size: 14px;
            color: #888;
            background: #1e222a;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .header-sub {
            color: #888;
            font-size: 14px;
            display: flex;
            gap: 20px;
        }

        /* Scan Panel */
        .scan-panel {
            background: #1a1c22;
            border: 1px solid #2a2e3a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            background: #0f1117;
            border: 1px solid #2a2e3a;
            color: #e0e0e0;
            padding: 15px;
            font-size: 16px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #00ffaa;
            box-shadow: 0 0 0 2px rgba(0,255,170,0.1);
        }

        .input-group button {
            background: #00ffaa;
            border: none;
            color: #0a0b0e;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }

        .input-group button:hover:not(:disabled) {
            background: #00cc88;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,255,170,0.3);
        }

        .input-group button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .scan-info {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            color: #888;
            font-size: 13px;
        }

        .scan-info i {
            color: #00ffaa;
            margin-right: 5px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #1a1c22;
            border: 1px solid #2a2e3a;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #00ffaa;
            transform: translateY(-2px);
        }

        .stat-card.critical {
            border-color: #ff4d4d;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #00ffaa;
            margin-bottom: 5px;
        }

        .stat-card.critical .stat-value {
            color: #ff4d4d;
        }

        .stat-label {
            color: #888;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-desc {
            font-size: 11px;
            color: #ff4d4d;
            margin-top: 5px;
        }

        /* Progress Section */
        .progress-section {
            background: #1a1c22;
            border: 1px solid #2a2e3a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .phase-indicator {
            color: #00ffaa;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 8px;
            background: #0f1117;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffaa, #00cc88);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-detail {
            color: #888;
            font-size: 12px;
            margin-top: 10px;
        }

        /* Main Content Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Subdomains Panel */
        .panel {
            background: #1a1c22;
            border: 1px solid #2a2e3a;
            border-radius: 8px;
            overflow: hidden;
        }

        .panel-header {
            background: #0f1117;
            padding: 15px;
            border-bottom: 1px solid #2a2e3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h3 {
            color: #e0e0e0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-header .badge {
            background: #00ffaa;
            color: #0a0b0e;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .panel-content {
            max-height: 600px;
            overflow-y: auto;
        }

        /* Subdomain Item */
        .subdomain-item {
            padding: 15px;
            border-bottom: 1px solid #2a2e3a;
            transition: all 0.2s;
        }

        .subdomain-item:hover {
            background: #22262f;
        }

        .subdomain-item.live {
            border-left: 3px solid #00ffaa;
        }

        .subdomain-item.dead {
            border-left: 3px solid #ff4d4d;
            opacity: 0.6;
        }

        .subdomain-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .subdomain-name {
            font-weight: 600;
            color: #00ffaa;
            cursor: pointer;
        }

        .subdomain-name:hover {
            text-decoration: underline;
        }

        .subdomain-badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 12px;
            background: #0f1117;
        }

        .badge-live {
            background: #00ffaa;
            color: #0a0b0e;
        }

        .badge-dead {
            background: #ff4d4d;
            color: #0a0b0e;
        }

        .subdomain-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 12px;
            color: #888;
            margin-top: 8px;
        }

        .tech-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 8px;
        }

        .tech-tag {
            background: #0f1117;
            border: 1px solid #2a2e3a;
            color: #00ffaa;
            padding: 2px 6px;
            font-size: 10px;
            border-radius: 3px;
        }

        /* Right Panel Sections */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section {
            background: #1a1c22;
            border: 1px solid #2a2e3a;
            border-radius: 8px;
            overflow: hidden;
        }

        .section.critical {
            border-color: #ff4d4d;
        }

        .section-header {
            background: #0f1117;
            padding: 15px;
            border-bottom: 1px solid #2a2e3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h3 {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-content {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        /* Findings Items */
        .finding-item {
            background: #22262f;
            border: 1px solid #2a2e3a;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .finding-item.critical {
            border-color: #ff4d4d;
        }

        .finding-url {
            font-size: 11px;
            color: #00ffaa;
            word-break: break-all;
            margin-bottom: 5px;
        }

        .finding-type {
            display: inline-block;
            background: #ff4d4d;
            color: #0a0b0e;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 600;
            border-radius: 3px;
            margin-bottom: 5px;
        }

        .finding-match {
            background: #0f1117;
            padding: 8px;
            font-size: 11px;
            font-family: 'Monaco', 'Menlo', monospace;
            border-radius: 3px;
            overflow-x: auto;
            color: #ffaa00;
        }

        .finding-context {
            font-size: 11px;
            color: #888;
            margin-top: 5px;
        }

        /* Port Item */
        .port-item {
            display: inline-block;
            background: #0f1117;
            border: 1px solid #2a2e3a;
            color: #00ffaa;
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 3px;
            margin: 2px;
        }

        .port-item.open {
            background: #00ffaa;
            color: #0a0b0e;
            border-color: #00ffaa;
        }

        /* URL Categories */
        .url-category {
            margin-bottom: 15px;
        }

        .url-category h4 {
            color: #888;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .url-item {
            background: #0f1117;
            padding: 5px 8px;
            font-size: 11px;
            margin: 2px 0;
            border-radius: 3px;
            color: #888;
            word-break: break-all;
        }

        .url-item:hover {
            background: #1a1c22;
            color: #00ffaa;
        }

        /* Log Panel */
        .log-panel {
            background: #1a1c22;
            border: 1px solid #2a2e3a;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 12px;
            font-family: 'Monaco', 'Menlo', monospace;
            margin-top: 20px;
        }

        .log-entry {
            color: #888;
            padding: 2px 0;
            border-bottom: 1px solid #2a2e3a;
        }

        .log-time {
            color: #00ffaa;
            margin-right: 10px;
        }

        .log-success { color: #00ffaa; }
        .log-error { color: #ff4d4d; }
        .log-warning { color: #ffaa00; }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #00ffaa;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid #2a2e3a;
            padding-bottom: 10px;
        }

        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
        }

        .tab:hover {
            background: #22262f;
        }

        .tab.active {
            background: #00ffaa;
            color: #0a0b0e;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                üîç SMART AI RECON - PROFESSIONAL RECONNAISSANCE
                <span>v2.0</span>
            </h1>
            <div class="header-sub">
                <span><i>üì°</i> 10+ Data Sources</span>
                <span><i>üî¨</i> Real-time Analysis</span>
                <span><i>‚ö†Ô∏è</i> Security Findings</span>
                <span><i>‚ö°</i> Wayback URLs</span>
                <span><i>üï∏Ô∏è</i> JS Analysis</span>
            </div>
        </div>

        <!-- Scan Panel -->
        <div class="scan-panel">
            <div class="input-group">
                <input type="text" id="domainInput" placeholder="Enter target domain (e.g., example.com)" value="google.com">
                <button id="scanBtn">START SMART SCAN</button>
            </div>
            <div class="scan-info">
                <span><i>üîç</i> Certificate Transparency</span>
                <span><i>üìä</i> DNS Dumpster</span>
                <span><i>üîÑ</i> Wayback Machine</span>
                <span><i>üìù</i> JavaScript Analysis</span>
                <span><i>üö™</i> Port Scanning</span>
                <span><i>üîê</i> Sensitive Paths</span>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="statTotal">0</div>
                <div class="stat-label">Subdomains Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statLive">0</div>
                <div class="stat-label">Live Hosts</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statResolved">0</div>
                <div class="stat-label">Resolved</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statUrls">0</div>
                <div class="stat-label">URLs Extracted</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statJs">0</div>
                <div class="stat-label">JS Files</div>
            </div>
            <div class="stat-card critical">
                <div class="stat-value" id="statSecrets">0</div>
                <div class="stat-label">Secrets Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statPorts">0</div>
                <div class="stat-label">Open Ports</div>
            </div>
        </div>

        <!-- Progress -->
        <div class="progress-section">
            <div class="phase-indicator" id="currentPhase">‚ö° Ready to scan</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="progress-detail" id="progressDetail"></div>
        </div>

        <!-- Main Content Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="subdomains">üåê Subdomains</div>
            <div class="tab" data-tab="urls">üîó URLs</div>
            <div class="tab" data-tab="js">üìú JavaScript</div>
            <div class="tab" data-tab="secrets">üîê Secrets</div>
            <div class="tab" data-tab="ports">üö™ Ports</div>
            <div class="tab" data-tab="paths">üìÅ Sensitive Paths</div>
            <div class="tab" data-tab="tech">‚öôÔ∏è Technologies</div>
        </div>

        <!-- Main Content -->
        <div class="main-grid">
            <!-- Left: Main Content -->
            <div class="panel" id="mainPanel">
                <div class="panel-header">
                    <h3 id="panelTitle">üåê Subdomains</h3>
                    <span class="badge" id="panelCount">0</span>
                </div>
                <div class="panel-content" id="panelContent">
                    <div style="padding: 40px; text-align: center; color: #888;">
                        Enter a domain and start scan
                    </div>
                </div>
            </div>

            <!-- Right: Findings -->
            <div class="right-panel">
                <!-- Critical Findings -->
                <div class="section critical" id="criticalSection">
                    <div class="section-header">
                        <h3>‚ö†Ô∏è CRITICAL FINDINGS</h3>
                        <span class="badge" id="criticalCount">0</span>
                    </div>
                    <div class="section-content" id="criticalList">
                        <div style="color: #888; text-align: center; padding: 20px;">
                            No critical findings yet
                        </div>
                    </div>
                </div>

                <!-- Technologies -->
                <div class="section">
                    <div class="section-header">
                        <h3>üîß Technologies Detected</h3>
                        <span class="badge" id="techCount">0</span>
                    </div>
                    <div class="section-content" id="techList">
                        <div style="color: #888; text-align: center; padding: 20px;">
                            No technologies detected
                        </div>
                    </div>
                </div>

                <!-- Open Ports -->
                <div class="section">
                    <div class="section-header">
                        <h3>üö™ Open Ports</h3>
                        <span class="badge" id="portCount">0</span>
                    </div>
                    <div class="section-content" id="portList">
                        <div style="color: #888; text-align: center; padding: 20px;">
                            No open ports found
                        </div>
                    </div>
                </div>

                <!-- URL Categories -->
                <div class="section">
                    <div class="section-header">
                        <h3>üìÇ URL Categories</h3>
                        <span class="badge" id="urlCategoryCount">0</span>
                    </div>
                    <div class="section-content" id="urlCategories">
                        <div style="color: #888; text-align: center; padding: 20px;">
                            No URLs extracted
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log Panel -->
        <div class="log-panel" id="logPanel"></div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : '/api';

        // DOM Elements
        const domainInput = document.getElementById('domainInput');
        const scanBtn = document.getElementById('scanBtn');
        const currentPhase = document.getElementById('currentPhase');
        const progressBar = document.getElementById('progressBar');
        const progressDetail = document.getElementById('progressDetail');
        const logPanel = document.getElementById('logPanel');
        
        // Stats
        const statTotal = document.getElementById('statTotal');
        const statLive = document.getElementById('statLive');
        const statResolved = document.getElementById('statResolved');
        const statUrls = document.getElementById('statUrls');
        const statJs = document.getElementById('statJs');
        const statSecrets = document.getElementById('statSecrets');
        const statPorts = document.getElementById('statPorts');
        
        // Panel
        const panelContent = document.getElementById('panelContent');
        const panelTitle = document.getElementById('panelTitle');
        const panelCount = document.getElementById('panelCount');
        
        // Findings
        const criticalList = document.getElementById('criticalList');
        const criticalCount = document.getElementById('criticalCount');
        const techList = document.getElementById('techList');
        const techCount = document.getElementById('techCount');
        const portList = document.getElementById('portList');
        const portCount = document.getElementById('portCount');
        const urlCategories = document.getElementById('urlCategories');
        const urlCategoryCount = document.getElementById('urlCategoryCount');

        // Tab switching
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                updatePanelForTab(tab.dataset.tab);
            });
        });

        function updatePanelForTab(tab) {
            panelTitle.textContent = {
                'subdomains': 'üåê Subdomains',
                'urls': 'üîó URLs',
                'js': 'üìú JavaScript Files',
                'secrets': 'üîê Secrets Found',
                'ports': 'üö™ Open Ports',
                'paths': 'üìÅ Sensitive Paths',
                'tech': '‚öôÔ∏è Technologies'
            }[tab] || 'üåê Subdomains';

            if (!window.currentResults) return;

            switch(tab) {
                case 'subdomains':
                    displaySubdomains(window.currentResults.data.subdomains);
                    break;
                case 'urls':
                    displayUrls(window.currentResults.data.urls);
                    break;
                case 'js':
                    displayJsFiles(window.currentResults.data.urls?.categorized?.js || []);
                    break;
                case 'secrets':
                    displaySecrets(window.currentResults.data.jsFindings || []);
                    break;
                case 'ports':
                    displayPorts(window.currentResults.data.openPorts || []);
                    break;
                case 'paths':
                    displaySensitivePaths(window.currentResults.data.sensitivePaths || []);
                    break;
                case 'tech':
                    displayTechnologies(window.currentResults.data.liveSubdomains || []);
                    break;
            }
        }

        // Logging
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const time = new Date().toLocaleTimeString();
            const logClass = {
                'success': 'log-success',
                'error': 'log-error',
                'warning': 'log-warning'
            }[type] || '';
            
            entry.innerHTML = `<span class="log-time">[${time}]</span> <span class="${logClass}">${message}</span>`;
            logPanel.appendChild(entry);
            logPanel.scrollTop = logPanel.scrollHeight;
            
            while (logPanel.children.length > 100) {
                logPanel.removeChild(logPanel.children[0]);
            }
        }

        // Display Functions
        function displaySubdomains(subdomains) {
            if (!subdomains || subdomains.length === 0) {
                panelContent.innerHTML = '<div style="padding:40px; text-align:center; color:#888;">No subdomains found</div>';
                return;
            }

            let html = '';
            subdomains.forEach(sub => {
                html += `
                    <div class="subdomain-item live">
                        <div class="subdomain-header">
                            <span class="subdomain-name" onclick="window.open('https://${sub}', '_blank')">${sub}</span>
                            <span class="subdomain-badge badge-live">RESOLVED</span>
                        </div>
                        <div class="subdomain-details">
                            <div><i>üîç</i> DNS Record</div>
                            <div><i>üì°</i> A/AAAA</div>
                            <div><i>‚ö°</i> Active</div>
                        </div>
                    </div>
                `;
            });
            panelContent.innerHTML = html;
            panelCount.textContent = subdomains.length;
        }

        function displayUrls(urls) {
            if (!urls || !urls.categorized) {
                panelContent.innerHTML = '<div style="padding:40px; text-align:center; color:#888;">No URLs found</div>';
                return;
            }

            let html = '';
            const categories = ['js', 'css', 'images', 'api', 'admin', 'backup', 'config', 'other'];
            
            categories.forEach(cat => {
                if (urls.categorized[cat] && urls.categorized[cat].length > 0) {
                    html += `<div style="margin-bottom:20px;">`;
                    html += `<h4 style="color:#00ffaa; margin-bottom:10px;">${cat.toUpperCase()} (${urls.categorized[cat].length})</h4>`;
                    urls.categorized[cat].slice(0, 10).forEach(item => {
                        html += `<div class="url-item" onclick="window.open('${item.url}', '_blank')">${item.url}</div>`;
                    });
                    if (urls.categorized[cat].length > 10) {
                        html += `<div style="color:#888; font-size:11px; margin-top:5px;">+${urls.categorized[cat].length - 10} more</div>`;
                    }
                    html += `</div>`;
                }
            });

            panelContent.innerHTML = html || '<div style="padding:40px; text-align:center; color:#888;">No URLs found</div>';
            panelCount.textContent = urls.total || 0;
        }

        function displayJsFiles(jsFiles) {
            if (!jsFiles || jsFiles.length === 0) {
                panelContent.innerHTML = '<div style="padding:40px; text-align:center; color:#888;">No JavaScript files found</div>';
                return;
            }

            let html = '';
            jsFiles.slice(0, 50).forEach(js => {
                html += `<div class="url-item" onclick="window.open('${js.url}', '_blank')">${js.url}</div>`;
            });
            if (jsFiles.length > 50) {
                html += `<div style="color:#888; font-size:11px; margin-top:10px;">+${jsFiles.length - 50} more JavaScript files</div>`;
            }
            panelContent.innerHTML = html;
            panelCount.textContent = jsFiles.length;
        }

        function displaySecrets(secrets) {
            if (!secrets || secrets.length === 0) {
                panelContent.innerHTML = '<div style="padding:40px; text-align:center; color:#888;">No secrets found</div>';
                return;
            }

            let html = '';
            secrets.forEach(secret => {
                html += `
                    <div class="finding-item critical">
                        <div class="finding-url">${secret.url}</div>
                        <span class="finding-type">${secret.type}</span>
                        ${secret.matches ? `
                            <div class="finding-match">${secret.matches.join('<br>')}</div>
                        ` : ''}
                        ${secret.context ? `
                            <div class="finding-context">Context: ${secret.context.substring(0, 100)}...</div>
                        ` : ''}
                    </div>
                `;
            });
            panelContent.innerHTML = html;
            panelCount.textContent = secrets.length;
        }

        function displayPorts(ports) {
            if (!ports || ports.length === 0) {
                panelContent.innerHTML = '<div style="padding:40px; text-align:center; color:#888;">No open ports found</div>';
                return;
            }

            let html = '<div style="display:flex; flex-wrap:wrap; gap:10px;">';
            const grouped = {};
            ports.forEach(p => {
                if (!grouped[p.subdomain]) grouped[p.subdomain] = [];
                grouped[p.subdomain].push(p);
            });

            Object.entries(grouped).forEach(([subdomain, portList]) => {
                html += `<div style="margin-bottom:20px; width:100%;">`;
                html += `<div style="color:#00ffaa; margin-bottom:5px;">${subdomain}</div>`;
                html += `<div style="display:flex; flex-wrap:wrap; gap:5px;">`;
                portList.forEach(p => {
                    html += `<span class="port-item open" title="${p.service}">${p.port}</span>`;
                });
                html += `</div></div>`;
            });
            html += '</div>';
            
            panelContent.innerHTML = html;
            panelCount.textContent = ports.length;
        }

        function displaySensitivePaths(paths) {
            if (!paths || paths.length === 0) {
                panelContent.innerHTML = '<div style="padding:40px; text-align:center; color:#888;">No sensitive paths found</div>';
                return;
            }

            let html = '';
            paths.forEach(path => {
                html += `
                    <div class="finding-item critical" onclick="window.open('${path.url}', '_blank')">
                        <div class="finding-url">${path.url}</div>
                        <span class="finding-type">Status: ${path.statusCode}</span>
                        ${path.contentPreview ? `
                            <div class="finding-match">${path.contentPreview.replace(/</g, '&lt;')}</div>
                        ` : ''}
                    </div>
                `;
            });
            panelContent.innerHTML = html;
            panelCount.textContent = paths.length;
        }

        function displayTechnologies(liveSubdomains) {
            const techs = new Map();
            liveSubdomains.forEach(sub => {
                if (sub.technologies) {
                    sub.technologies.forEach(t => {
                        techs.set(t.name, t);
                    });
                }
            });

            let html = '<div style="display:flex; flex-wrap:wrap; gap:5px;">';
            Array.from(techs.values()).forEach(t => {
                html += `<span class="tech-tag">${t.name}</span>`;
            });
            html += '</div>';
            
            panelContent.innerHTML = html || '<div style="padding:40px; text-align:center; color:#888;">No technologies detected</div>';
            panelCount.textContent = techs.size;
        }

        function updateCriticalFindings(secrets, paths) {
            const allCritical = [...(secrets || []), ...(paths || [])];
            criticalCount.textContent = allCritical.length;
            
            if (allCritical.length === 0) {
                criticalList.innerHTML = '<div style="color:#888; text-align:center; padding:20px;">No critical findings</div>';
                return;
            }

            let html = '';
            allCritical.slice(0, 5).forEach(item => {
                if (item.type) {
                    // Secret
                    html += `
                        <div class="finding-item critical">
                            <div class="finding-url">${item.url}</div>
                            <span class="finding-type">${item.type}</span>
                        </div>
                    `;
                } else {
                    // Path
                    html += `
                        <div class="finding-item critical">
                            <div class="finding-url">${item.url}</div>
                            <span class="finding-type">Exposed Path</span>
                        </div>
                    `;
                }
            });
            if (allCritical.length > 5) {
                html += `<div style="color:#888; font-size:11px; margin-top:5px;">+${allCritical.length - 5} more findings</div>`;
            }
            criticalList.innerHTML = html;
        }

        function updateTechnologies(liveSubdomains) {
            const techs = new Set();
            liveSubdomains.forEach(sub => {
                if (sub.technologies) {
                    sub.technologies.forEach(t => techs.add(t.name));
                }
            });
            
            techCount.textContent = techs.size;
            
            let html = '<div style="display:flex; flex-wrap:wrap; gap:5px;">';
            Array.from(techs).slice(0, 20).forEach(t => {
                html += `<span class="tech-tag">${t}</span>`;
            });
            if (techs.size > 20) {
                html += `<span class="tech-tag">+${techs.size - 20}</span>`;
            }
            html += '</div>';
            techList.innerHTML = html || '<div style="color:#888;">No technologies</div>';
        }

        function updatePorts(ports) {
            portCount.textContent = ports.length;
            
            if (ports.length === 0) {
                portList.innerHTML = '<div style="color:#888;">No open ports</div>';
                return;
            }

            const grouped = {};
            ports.forEach(p => {
                if (!grouped[p.subdomain]) grouped[p.subdomain] = [];
                grouped[p.subdomain].push(p);
            });

            let html = '';
            Object.entries(grouped).slice(0, 3).forEach(([subdomain, portList]) => {
                html += `<div style="margin-bottom:10px;">`;
                html += `<div style="font-size:11px; color:#888;">${subdomain}</div>`;
                html += `<div style="display:flex; flex-wrap:wrap; gap:3px;">`;
                portList.slice(0, 10).forEach(p => {
                    html += `<span class="port-item open" title="${p.service}">${p.port}</span>`;
                });
                if (portList.length > 10) {
                    html += `<span class="port-item">+${portList.length - 10}</span>`;
                }
                html += `</div></div>`;
            });
            portList.innerHTML = html;
        }

        function updateUrlCategories(urls) {
            if (!urls || !urls.categorized) {
                urlCategoryCount.textContent = '0';
                urlCategories.innerHTML = '<div style="color:#888;">No URLs</div>';
                return;
            }

            let total = 0;
            let html = '';
            const categories = ['js', 'api', 'admin', 'backup', 'config'];
            
            categories.forEach(cat => {
                if (urls.categorized[cat] && urls.categorized[cat].length > 0) {
                    total += urls.categorized[cat].length;
                    html += `
                        <div style="margin-bottom:10px;">
                            <div style="display:flex; justify-content:space-between; color:#888; font-size:11px;">
                                <span>${cat.toUpperCase()}</span>
                                <span>${urls.categorized[cat].length}</span>
                            </div>
                            <div style="height:4px; background:#0f1117; margin-top:2px;">
                                <div style="height:100%; width:${Math.min(100, (urls.categorized[cat].length / 100) * 100)}%; background:#00ffaa;"></div>
                            </div>
                        </div>
                    `;
                }
            });
            
            urlCategoryCount.textContent = total;
            urlCategories.innerHTML = html || '<div style="color:#888;">No URLs</div>';
        }

        // Scan Function
        async function startScan() {
            const domain = domainInput.value.trim();
            if (!domain) {
                addLog('Please enter a domain', 'error');
                return;
            }

            // Disable UI
            scanBtn.disabled = true;
            scanBtn.textContent = 'SCANNING...';
            
            // Reset UI
            progressBar.style.width = '0%';
            currentPhase.textContent = '‚ö° Starting reconnaissance...';
            
            addLog(`üöÄ Starting smart reconnaissance on ${domain}`, 'success');

            // Simulate progress
            let progress = 0;
            const phases = [
                'Subdomain Enumeration',
                'DNS Resolution',
                'HTTP Probing',
                'URL Extraction',
                'JavaScript Analysis',
                'Sensitive Path Scanning',
                'Port Scanning'
            ];

            const progressInterval = setInterval(() => {
                progress += 1;
                if (progress <= 90) {
                    progressBar.style.width = progress + '%';
                    const phaseIndex = Math.floor(progress / 13);
                    if (phaseIndex < phases.length) {
                        currentPhase.textContent = `‚ö° Phase ${phaseIndex + 1}: ${phases[phaseIndex]}`;
                    }
                    progressDetail.textContent = `Processing... ${progress}% complete`;
                }
            }, 500);

            try {
                const response = await fetch(`${API_BASE}/smart-scan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ domain })
                });

                clearInterval(progressInterval);

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Scan failed');
                }

                const data = await response.json();
                window.currentResults = data;

                // Update stats
                statTotal.textContent = data.summary.subdomainsFound;
                statLive.textContent = data.summary.liveSubdomains;
                statResolved.textContent = data.phases.dnsResolution?.count || 0;
                statUrls.textContent = data.summary.urlsExtracted;
                statJs.textContent = data.data.urls?.categorized?.js?.length || 0;
                statSecrets.textContent = data.summary.secretsFound;
                statPorts.textContent = data.summary.openPortsFound;

                // Update findings
                updateCriticalFindings(data.data.jsFindings, data.data.sensitivePaths);
                updateTechnologies(data.data.liveSubdomains || []);
                updatePorts(data.data.openPorts || []);
                updateUrlCategories(data.data.urls);

                // Update current tab
                const activeTab = document.querySelector('.tab.active').dataset.tab;
                updatePanelForTab(activeTab);

                // Complete progress
                progressBar.style.width = '100%';
                currentPhase.textContent = '‚úÖ Scan Complete!';
                progressDetail.textContent = `Found ${data.summary.subdomainsFound} subdomains, ${data.summary.secretsFound} secrets in ${(data.duration / 1000).toFixed(2)}s`;

                addLog(`‚úÖ Scan complete! Found ${data.summary.subdomainsFound} subdomains, ${data.summary.secretsFound} secrets`, 'success');
                
                if (data.summary.secretsFound > 0) {
                    addLog(`‚ö†Ô∏è CRITICAL: ${data.summary.secretsFound} secrets found! Review immediately`, 'warning');
                }

            } catch (error) {
                clearInterval(progressInterval);
                addLog(`‚ùå Error: ${error.message}`, 'error');
                console.error(error);
                
                progressBar.style.width = '0%';
                currentPhase.textContent = '‚ùå Scan Failed';
                progressDetail.textContent = error.message;
                
            } finally {
                scanBtn.disabled = false;
                scanBtn.textContent = 'START SMART SCAN';
            }
        }

        // Event listeners
        scanBtn.addEventListener('click', startScan);
        domainInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') startScan();
        });

        addLog('System ready. Enter a domain to begin smart reconnaissance.', 'info');
    </script>
</body>
</html>
